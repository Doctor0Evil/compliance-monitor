version: 1.0.0
name: Bit.Hub Default Config Injection
description: >
  Baseline configuration for workflows, runners, and policies.
  Applied automatically by Bit.Hub bootstrap scripts and megawall runs.

defaults:
  workflow:
    permissions:
      contents: read
    concurrency:
      group: wf-${{ github.ref }}
      cancel-in-progress: false
    timeout-minutes: 30
    checkout_version: actions/checkout@v4
    adaptive_runs_on:
      - self-hosted
      - bit.hub
      - linux

  runner:
    required_labels:
      - bit.hub
      - linux
    forbidden_labels:
      - untrusted
    min_os: ubuntu-20.04

  container:
    required_oci_labels:
      - org.opencontainers.image.source
      - org.opencontainers.image.description
      - org.opencontainers.image.licenses
    forbid_root_user: true
    disallow_latest_tag_in_publish: true

policies:
  modules:
    - path: .bithub/policy/workflow.rego
      package: bithub.workflow
    - path: .bithub/policy/container.rego
      package: bithub.container
    - path: .bithub/policy/runner.rego
      package: bithub.runner
    - path: .bithub/policy/content.rego
      package: bithub.content

actions:
  on_warning:
    - annotate
    - write_report
  on_denial:
    - write_report
    - block_merge
  self_heal: true

notes:
  - This file is read by Bit.Hub bootstrap harnesses and Laughter.exe.
  - Defaults are injected into workflows at runtime if missing.
  - Policies listed here are evaluated before any job executes.
git-runner: run: .bit/config.bit.create

            - name: Setup .NET Core SDK
  uses: actions/setup-dotnet@v3.4.2
  with:
    # Optional SDK version(s) to use. If not provided, will install global.json version when available. Examples: 2.2.104, 3.1, 3.1.x, 3.x, 6.0.2xx
    dotnet-version: # optional
    # Optional quality of the build. The possible values are: daily, signed, validated, preview, ga.
    dotnet-quality: # optional
    # Optional global.json location, if your global.json isn't located in the root of the repo.
    global-json-file: # optional
    # Optional package source for which to set up authentication. Will consult any existing NuGet.config in the root of the repo and provide a temporary NuGet.config using the NUGET_AUTH_TOKEN environment variable as a ClearTextPassword
    source-url: # optional
    # Optional OWNER for using packages from GitHub Package Registry organizations/users other than the current repository's owner. Only used if a GPR URL is also provided in source-url
    owner: # optional
    # Optional NuGet.config location, if your NuGet.config isn't located in the root of the repo.
    config-file: # optional
    # Optional input to enable caching of the NuGet global-packages folder
    cache: # optional
    # Used to specify the path to a dependency file: packages.lock.json. Supports wildcards or a list of file names for caching multiple dependencies.
    cache-dependency-path: # optional
