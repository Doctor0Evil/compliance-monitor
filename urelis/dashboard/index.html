<!-- aurelis/dashboard/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURELIS - Ethical Creation Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web5/dist/browser.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--light);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px 0;
            background: rgba(44, 62, 80, 0.9);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .gold-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .credit-item {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.5);
            border-radius: 5px;
            padding: 10px;
            margin: 5px 0;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .market-up {
            color: var(--success);
        }
        
        .market-down {
            color: var(--accent);
        }
    </style>
</head>
<body>
    <div class="gold-rain" id="goldRain"></div>
    
    <div class="container">
        <div class="header">
            <h1>AURELIS Ethical Creation Engine</h1>
            <p>Converting market energy into creation resources - No speculation, pure creation</p>
        </div>
        
        <div class="dashboard-grid">
            <div class="card stat-card">
                <div class="stat-label">Total Credit Pool</div>
                <div class="stat-value" id="creditPool">0 CC</div>
                <div class="stat-label">Available for distribution</div>
            </div>
            
            <div class="card stat-card">
                <div class="stat-label">Reserve Pool</div>
                <div class="stat-value" id="reservePool">0 CC</div>
                <div class="stat-label">Market stability fund</div>
            </div>
            
            <div class="card stat-card">
                <div class="stat-label">Today's Distribution</div>
                <div class="stat-value" id="dailyDistribution">0 CC</div>
                <div class="stat-label">To creators worldwide</div>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="card">
                <h3>Live Market Feed</h3>
                <div id="marketFeed">
                    <div class="market-item">Loading market data...</div>
                </div>
            </div>
            
            <div class="card">
                <h3>Real-time Credit Allocation</h3>
                <div id="creditAllocations">
                    <div class="credit-item">Waiting for allocations...</div>
                </div>
            </div>
            
            <div class="card">
                <h3>Distribution Analytics</h3>
                <canvas id="distributionChart" width="400" height="300"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h3>Ethical Allocation Policy</h3>
            <div id="allocationPolicy">
                <p><strong>Core Principles:</strong></p>
                <ul>
                    <li>No speculation or gambling - market data is read-only</li>
                    <li>Universal basic allocation for all registered creators</li>
                    <li>Merit-based bonuses for high-impact projects</li>
                    <li>Transparent, auditable allocation ledger</li>
                    <li>Purpose-limited credits (non-transferable)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        class AURELISDashboard {
            constructor() {
                this.creditPool = 0;
                this.reservePool = 0;
                this.marketData = {};
                this.allocations = [];
                this.charts = {};
                
                this.init();
            }
            
            async init() {
                await this.initWeb5();
                this.initCharts();
                this.connectToDataFeed();
                this.startGoldRainAnimation();
            }
            
            async initWeb5() {
                try {
                    const { web5, did } = await Web5.connect();
                    this.web5 = web5;
                    this.userDid = did;
                    console.log("Web5 connected with DID:", did);
                } catch (error) {
                    console.error("Web5 initialization failed:", error);
                }
            }
            
            initCharts() {
                const ctx = document.getElementById('distributionChart').getContext('2d');
                this.charts.distribution = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Development', 'Research', 'Content', 'Education', 'Grants'],
                        datasets: [{
                            data: [25, 25, 20, 20, 10],
                            backgroundColor: [
                                '#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            connectToDataFeed() {
                // Connect to WebSocket or server-sent events
                const eventSource = new EventSource('/aurelis-data-stream');
                
                eventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    this.updateDashboard(data);
                };
                
                eventSource.onerror = (error) => {
                    console.error('EventSource failed:', error);
                    // Fallback to polling
                    setInterval(() => this.pollData(), 5000);
                };
            }
            
            async pollData() {
                try {
                    const response = await fetch('/aurelis-data');
                    const data = await response.json();
                    this.updateDashboard(data);
                } catch (error) {
                    console.error('Polling error:', error);
                }
            }
            
            updateDashboard(data) {
                // Update credit pools
                this.creditPool = data.credit_pool || 0;
                this.reservePool = data.reserve_pool || 0;
                
                document.getElementById('creditPool').textContent = 
                    `${this.creditPool.toLocaleString()} CC`;
                document.getElementById('reservePool').textContent = 
                    `${this.reservePool.toLocaleString()} CC`;
                
                // Update market feed
                if (data.market_data) {
                    this.updateMarketFeed(data.market_data);
                }
                
                // Update allocations
                if (data.allocations) {
                    this.updateAllocations(data.allocations);
                }
                
                // Update distribution chart
                if (data.distribution) {
                    this.updateDistributionChart(data.distribution);
                }
            }
            
            updateMarketFeed(marketData) {
                const feedContainer = document.getElementById('marketFeed');
                feedContainer.innerHTML = '';
                
                Object.values(marketData).forEach(asset => {
                    const changeClass = asset.change >= 0 ? 'market-up' : 'market-down';
                    const changeIcon = asset.change >= 0 ? 'ðŸ“ˆ' : 'ðŸ“‰';
                    
                    const item = document.createElement('div');
                    item.className = 'market-item';
                    item.innerHTML = `
                        <strong>${asset.symbol}</strong>: $${asset.price.toFixed(2)} 
                        <span class="${changeClass}">${changeIcon} ${Math.abs(asset.change).toFixed(2)}%</span>
                        <small>Vol: ${asset.volatility.toFixed(4)}</small>
                    `;
                    
                    feedContainer.appendChild(item);
                });
            }
            
            updateAllocations(allocations) {
                const container = document.getElementById('creditAllocations');
                container.innerHTML = '';
                
                allocations.slice(-10).forEach(allocation => {
                    const item = document.createElement('div');
                    item.className = 'credit-item';
                    item.innerHTML = `
                        <strong>${allocation.user_did}</strong>: 
                        ${allocation.amount.toFixed(2)} CC 
                        <small>for ${allocation.purpose}</small>
                    `;
                    container.appendChild(item);
                });
                
                // Update daily distribution total
                const dailyTotal = allocations.reduce((sum, a) => sum + a.amount, 0);
                document.getElementById('dailyDistribution').textContent = 
                    `${dailyTotal.toLocaleString()} CC`;
            }
            
            updateDistributionChart(distribution) {
                this.charts.distribution.data.datasets[0].data = [
                    distribution.development || 0,
                    distribution.research || 0,
                    distribution.content || 0,
                    distribution.education || 0,
                    distribution.grants || 0
                ];
                this.charts.distribution.update();
            }
            
            startGoldRainAnimation() {
                const container = document.getElementById('goldRain');
                setInterval(() => {
                    if (this.creditPool > 0) {
                        this.createGoldDrop();
                    }
                }, 300);
            }
            
            createGoldDrop() {
                const drop = document.createElement('div');
                drop.style.position = 'absolute';
                drop.style.top = '0px';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.width = '2px';
                drop.style.height = '15px';
                drop.style.background = 'linear-gradient(to bottom, #FFD700, #FFB700)';
                drop.style.boxShadow = '0 0 8px #FFD700';
                drop.style.borderRadius = '2px';
                drop.style.opacity = '0.7';
                
                document.getElementById('goldRain').appendChild(drop);
                
                let position = 0;
                const fall = setInterval(() => {
                    position += 2;
                    drop.style.top = position + 'px';
                    
                    if (position > window.innerHeight) {
                        clearInterval(fall);
                        drop.remove();
                    }
                }, 10);
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.aurelisDashboard = new AURELISDashboard();
        });
    </script>
</body>
</html>
